# çŒ«ç ‚ç½‘ç«™æ³¨å†Œç™»å½•åŠŸèƒ½å®æ–½æ–¹æ¡ˆï¼ˆå…¨æ–°ç‹¬ç«‹APIç‰ˆï¼‰

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

ä¸ºPawganicçŒ«ç ‚ç½‘ç«™æ·»åŠ å®Œæ•´çš„ç”¨æˆ·æ³¨å†Œå’Œç™»å½•åŠŸèƒ½ï¼Œ**åˆ›å»ºå…¨æ–°çš„ã€ç‹¬ç«‹çš„å‰ç«¯ç”¨æˆ·ç³»ç»Ÿ**ï¼Œä¸åå°ç®¡ç†ç³»ç»Ÿå®Œå…¨åˆ†ç¦»ã€‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### å½“å‰æŠ€æœ¯æ ˆ
- **å‰ç«¯**: WordPressé™æ€HTMLé¡µé¢ (è¿è¡Œåœ¨ http://localhost:8080)
- **åå°ç®¡ç†**: Vue3 + Element Plus (è¿è¡Œåœ¨ http://localhost:80) - **ç‹¬ç«‹ç³»ç»Ÿ**
- **åç«¯API**: NestJS + Prisma + MySQL (è¿è¡Œåœ¨ http://localhost:3000)
- **æ•°æ®åº“**: MySQL (meimei-prisma)
- **ç¼“å­˜**: Redis

### æ¶æ„è®¾è®¡åŸåˆ™
âœ… **å‰ç«¯ç”¨æˆ·** å’Œ **åå°ç®¡ç†å‘˜** å®Œå…¨åˆ†ç¦»
âœ… ä½¿ç”¨ç‹¬ç«‹çš„æ•°æ®è¡¨ `customer` å­˜å‚¨å‰ç«¯ç”¨æˆ·
âœ… åˆ›å»ºç‹¬ç«‹çš„APIæ¨¡å— `frontend-auth`
âœ… å¯ç”¨CORSæ”¯æŒè·¨åŸŸè®¿é—®
âœ… ä½¿ç”¨ç‹¬ç«‹çš„JWT tokenç®¡ç†

## ğŸ“ æ¶‰åŠçš„é¡µé¢æ–‡ä»¶

### å‰ç«¯é¡µé¢
1. **ç™»å½•é¡µé¢**: `frontend/my-account/index.html`
2. **æ³¨å†Œé¡µé¢**: `frontend/register/index.html`
3. **ä¸ªäººä¸­å¿ƒ**: `frontend/Personal-Center/index.html`
4. **æ‰¾å›å¯†ç **: `frontend/my-account/lost-password/index.html`
5. **æ‰€æœ‰é¡µé¢çš„é¡¶éƒ¨å¯¼èˆªæ **: Sign In ä¸‹æ‹‰æ¡†

## ğŸ¯ åŠŸèƒ½éœ€æ±‚

### 1. ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½
- âœ… ç”¨æˆ·å/é‚®ç®±æ³¨å†Œ
- âœ… å¯†ç å¼ºåº¦éªŒè¯ï¼ˆæœ€å°‘6ä½ï¼‰
- âœ… é‚®ç®±æ ¼å¼éªŒè¯
- âœ… æ‰‹æœºå·éªŒè¯ï¼ˆå¯é€‰ï¼‰
- âœ… æ³¨å†ŒæˆåŠŸåè‡ªåŠ¨ç™»å½•
- âœ… ç”¨æˆ·åå”¯ä¸€æ€§æ£€æŸ¥
- âœ… é‚®ç®±å”¯ä¸€æ€§æ£€æŸ¥

### 2. ç”¨æˆ·ç™»å½•åŠŸèƒ½
- âœ… ç”¨æˆ·å/é‚®ç®±ç™»å½•
- âœ… å¯†ç ç™»å½•
- âœ… è®°ä½æˆ‘åŠŸèƒ½ï¼ˆ30å¤©tokenï¼‰
- âœ… ç™»å½•çŠ¶æ€ä¿æŒ
- âœ… ç™»å½•æ—¥å¿—è®°å½•
- âš ï¸ æ— éªŒè¯ç ï¼ˆå¯é€‰ï¼šåç»­æ·»åŠ å¤±è´¥æ¬¡æ•°é™åˆ¶ï¼‰

### 3. ç”¨æˆ·ä¿¡æ¯ç®¡ç†
- âœ… æŸ¥çœ‹ä¸ªäººä¿¡æ¯
- âœ… ä¿®æ”¹ä¸ªäººèµ„æ–™ï¼ˆæ˜µç§°ã€é‚®ç®±ã€æ‰‹æœºå·ï¼‰
- âœ… ä¿®æ”¹å¯†ç 
- âœ… ä¸Šä¼ å¤´åƒ
- âœ… é€€å‡ºç™»å½•

### 4. æ‰¾å›å¯†ç 
- âœ… é€šè¿‡é‚®ç®±æ‰¾å›å¯†ç 
- âœ… å‘é€é‡ç½®å¯†ç é‚®ä»¶
- âœ… éªŒè¯é‡ç½®ä»¤ç‰Œ
- âœ… é‡ç½®å¯†ç 

## ï¿½ æ•°æ®åº“è®¾è®¡

### æ–°å¢è¡¨ï¼šcustomerï¼ˆå‰ç«¯ç”¨æˆ·è¡¨ï¼‰

```sql
-- å‰ç«¯ç”¨æˆ·è¡¨
CREATE TABLE `customer` (
  `customerId` INT NOT NULL AUTO_INCREMENT COMMENT 'ç”¨æˆ·ID',
  `userName` VARCHAR(50) NOT NULL COMMENT 'ç”¨æˆ·å',
  `nickName` VARCHAR(50) NOT NULL COMMENT 'æ˜µç§°',
  `email` VARCHAR(100) NOT NULL COMMENT 'é‚®ç®±',
  `phonenumber` VARCHAR(20) DEFAULT NULL COMMENT 'æ‰‹æœºå·',
  `password` VARCHAR(100) NOT NULL COMMENT 'å¯†ç ï¼ˆbcryptåŠ å¯†ï¼‰',
  `avatar` VARCHAR(200) DEFAULT '' COMMENT 'å¤´åƒURL',
  `sex` CHAR(1) DEFAULT '0' COMMENT 'æ€§åˆ«ï¼š0-æœªçŸ¥ï¼Œ1-ç”·ï¼Œ2-å¥³',
  `status` CHAR(1) DEFAULT '0' COMMENT 'çŠ¶æ€ï¼š0-æ­£å¸¸ï¼Œ1-ç¦ç”¨',
  `delFlag` CHAR(1) DEFAULT '0' COMMENT 'åˆ é™¤æ ‡å¿—ï¼š0-æœªåˆ é™¤ï¼Œ1-å·²åˆ é™¤',
  `loginIp` VARCHAR(128) DEFAULT '' COMMENT 'æœ€åç™»å½•IP',
  `loginDate` DATETIME DEFAULT NULL COMMENT 'æœ€åç™»å½•æ—¶é—´',
  `createTime` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `updateTime` DATETIME DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  `remark` VARCHAR(500) DEFAULT NULL COMMENT 'å¤‡æ³¨',
  PRIMARY KEY (`customerId`),
  UNIQUE KEY `customer_userName_key` (`userName`),
  UNIQUE KEY `customer_email_key` (`email`),
  KEY `idx_customer_status` (`status`),
  KEY `idx_customer_createTime` (`createTime`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='å‰ç«¯ç”¨æˆ·è¡¨';
```

### æ–°å¢è¡¨ï¼šcustomer_login_logï¼ˆå‰ç«¯ç”¨æˆ·ç™»å½•æ—¥å¿—ï¼‰

```sql
-- å‰ç«¯ç”¨æˆ·ç™»å½•æ—¥å¿—è¡¨
CREATE TABLE `customer_login_log` (
  `logId` INT NOT NULL AUTO_INCREMENT COMMENT 'æ—¥å¿—ID',
  `customerId` INT DEFAULT NULL COMMENT 'ç”¨æˆ·ID',
  `userName` VARCHAR(50) DEFAULT '' COMMENT 'ç”¨æˆ·å',
  `ipaddr` VARCHAR(128) DEFAULT '' COMMENT 'ç™»å½•IP',
  `loginLocation` VARCHAR(255) DEFAULT '' COMMENT 'ç™»å½•åœ°ç‚¹',
  `browser` VARCHAR(50) DEFAULT '' COMMENT 'æµè§ˆå™¨',
  `os` VARCHAR(50) DEFAULT '' COMMENT 'æ“ä½œç³»ç»Ÿ',
  `status` CHAR(1) DEFAULT '0' COMMENT 'ç™»å½•çŠ¶æ€ï¼š0-æˆåŠŸï¼Œ1-å¤±è´¥',
  `msg` VARCHAR(255) DEFAULT '' COMMENT 'æç¤ºæ¶ˆæ¯',
  `loginTime` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'ç™»å½•æ—¶é—´',
  PRIMARY KEY (`logId`),
  KEY `idx_customer_login_log_customerId` (`customerId`),
  KEY `idx_customer_login_log_loginTime` (`loginTime`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='å‰ç«¯ç”¨æˆ·ç™»å½•æ—¥å¿—';
```

### æ–°å¢è¡¨ï¼špassword_reset_tokenï¼ˆå¯†ç é‡ç½®ä»¤ç‰Œï¼‰

```sql
-- å¯†ç é‡ç½®ä»¤ç‰Œè¡¨
CREATE TABLE `password_reset_token` (
  `tokenId` INT NOT NULL AUTO_INCREMENT COMMENT 'ä»¤ç‰ŒID',
  `customerId` INT NOT NULL COMMENT 'ç”¨æˆ·ID',
  `email` VARCHAR(100) NOT NULL COMMENT 'é‚®ç®±',
  `token` VARCHAR(100) NOT NULL COMMENT 'é‡ç½®ä»¤ç‰Œ',
  `expiresAt` DATETIME NOT NULL COMMENT 'è¿‡æœŸæ—¶é—´',
  `used` TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦å·²ä½¿ç”¨ï¼š0-æœªä½¿ç”¨ï¼Œ1-å·²ä½¿ç”¨',
  `createTime` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  PRIMARY KEY (`tokenId`),
  UNIQUE KEY `password_reset_token_token_key` (`token`),
  KEY `idx_password_reset_token_customerId` (`customerId`),
  KEY `idx_password_reset_token_expiresAt` (`expiresAt`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='å¯†ç é‡ç½®ä»¤ç‰Œè¡¨';
```

## ğŸ”Œ åç«¯APIæ¥å£ï¼ˆå…¨æ–°ç‹¬ç«‹ï¼‰

### APIè·¯ç”±å‰ç¼€ï¼š`/api/frontend`

æ‰€æœ‰å‰ç«¯ç”¨æˆ·ç›¸å…³çš„APIéƒ½ä½¿ç”¨ `/api/frontend` å‰ç¼€ï¼Œä¸åå°ç®¡ç†APIå®Œå…¨åˆ†ç¦»ã€‚

### 1. ç”¨æˆ·æ³¨å†Œ
```typescript
POST /api/frontend/auth/register
Content-Type: application/json

è¯·æ±‚ä½“:
{
  "userName": "testuser",
  "nickName": "æµ‹è¯•ç”¨æˆ·",
  "email": "test@example.com",
  "phonenumber": "13800138000",  // å¯é€‰
  "password": "123456",
  "confirmPassword": "123456"
}

æˆåŠŸå“åº” (200):
{
  "code": 200,
  "msg": "æ³¨å†ŒæˆåŠŸ",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "customerId": 1,
      "userName": "testuser",
      "nickName": "æµ‹è¯•ç”¨æˆ·",
      "email": "test@example.com",
      "avatar": "",
      "sex": "0"
    }
  }
}

å¤±è´¥å“åº” (400):
{
  "code": 400,
  "msg": "ç”¨æˆ·åå·²å­˜åœ¨" // æˆ– "é‚®ç®±å·²è¢«æ³¨å†Œ" / "ä¸¤æ¬¡å¯†ç ä¸ä¸€è‡´"
}
```

### 2. ç”¨æˆ·ç™»å½•ï¼ˆæ— éœ€éªŒè¯ç ï¼‰
```typescript
POST /api/frontend/auth/login
Content-Type: application/json

è¯·æ±‚ä½“:
{
  "username": "testuser",  // ç”¨æˆ·åæˆ–é‚®ç®±
  "password": "123456",
  "rememberMe": true       // å¯é€‰ï¼Œè®°ä½æˆ‘ï¼ˆ30å¤©ï¼‰
}

æˆåŠŸå“åº” (200):
{
  "code": 200,
  "msg": "ç™»å½•æˆåŠŸ",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "customerId": 1,
      "userName": "testuser",
      "nickName": "æµ‹è¯•ç”¨æˆ·",
      "email": "test@example.com",
      "phonenumber": "13800138000",
      "avatar": "",
      "sex": "0"
    }
  }
}

å¤±è´¥å“åº” (401):
{
  "code": 401,
  "msg": "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯" // æˆ– "è´¦å·å·²è¢«ç¦ç”¨"
}
```

### 3. è·å–ç”¨æˆ·ä¿¡æ¯
```typescript
GET /api/frontend/auth/profile
Authorization: Bearer {token}

æˆåŠŸå“åº” (200):
{
  "code": 200,
  "msg": "æˆåŠŸ",
  "data": {
    "customerId": 1,
    "userName": "testuser",
    "nickName": "æµ‹è¯•ç”¨æˆ·",
    "email": "test@example.com",
    "phonenumber": "13800138000",
    "avatar": "",
    "sex": "0",
    "createTime": "2024-11-04T10:00:00.000Z"
  }
}

å¤±è´¥å“åº” (401):
{
  "code": 401,
  "msg": "ç™»å½•çŠ¶æ€å·²è¿‡æœŸ"
}
```

### 4. æ›´æ–°ç”¨æˆ·ä¿¡æ¯
```typescript
PUT /api/frontend/auth/profile
Authorization: Bearer {token}
Content-Type: application/json

è¯·æ±‚ä½“:
{
  "nickName": "æ–°æ˜µç§°",
  "email": "newemail@example.com",
  "phonenumber": "13900139000",
  "sex": "1"
}

æˆåŠŸå“åº” (200):
{
  "code": 200,
  "msg": "æ›´æ–°æˆåŠŸ"
}
```

### 5. ä¿®æ”¹å¯†ç 
```typescript
PUT /api/frontend/auth/password
Authorization: Bearer {token}
Content-Type: application/json

è¯·æ±‚ä½“:
{
  "oldPassword": "123456",
  "newPassword": "654321",
  "confirmPassword": "654321"
}

æˆåŠŸå“åº” (200):
{
  "code": 200,
  "msg": "å¯†ç ä¿®æ”¹æˆåŠŸ"
}

å¤±è´¥å“åº” (400):
{
  "code": 400,
  "msg": "åŸå¯†ç é”™è¯¯" // æˆ– "ä¸¤æ¬¡å¯†ç ä¸ä¸€è‡´"
}
```

### 6. é€€å‡ºç™»å½•
```typescript
POST /api/frontend/auth/logout
Authorization: Bearer {token}

æˆåŠŸå“åº” (200):
{
  "code": 200,
  "msg": "é€€å‡ºæˆåŠŸ"
}
```

### 7. æ‰¾å›å¯†ç  - å‘é€é‚®ä»¶
```typescript
POST /api/frontend/auth/forgot-password
Content-Type: application/json

è¯·æ±‚ä½“:
{
  "email": "test@example.com"
}

æˆåŠŸå“åº” (200):
{
  "code": 200,
  "msg": "é‡ç½®å¯†ç é‚®ä»¶å·²å‘é€ï¼Œè¯·æŸ¥æ”¶"
}

å¤±è´¥å“åº” (404):
{
  "code": 404,
  "msg": "è¯¥é‚®ç®±æœªæ³¨å†Œ"
}
```

### 8. æ‰¾å›å¯†ç  - é‡ç½®å¯†ç 
```typescript
POST /api/frontend/auth/reset-password
Content-Type: application/json

è¯·æ±‚ä½“:
{
  "token": "reset-token-string",
  "newPassword": "newpass123",
  "confirmPassword": "newpass123"
}

æˆåŠŸå“åº” (200):
{
  "code": 200,
  "msg": "å¯†ç é‡ç½®æˆåŠŸ"
}

å¤±è´¥å“åº” (400):
{
  "code": 400,
  "msg": "é‡ç½®ä»¤ç‰Œæ— æ•ˆæˆ–å·²è¿‡æœŸ"
}
```

## ğŸ’» å®æ–½æ­¥éª¤

### é˜¶æ®µä¸€ï¼šæ•°æ®åº“å‡†å¤‡ï¼ˆä¼˜å…ˆçº§ï¼šæœ€é«˜ï¼‰â­

#### æ­¥éª¤ 1.1ï¼šåˆ›å»ºæ•°æ®åº“è¡¨
åœ¨MySQLä¸­æ‰§è¡Œä»¥ä¸‹SQLè¯­å¥åˆ›å»ºä¸‰å¼ æ–°è¡¨ï¼š

```bash
# è¿æ¥åˆ°MySQLæ•°æ®åº“
mysql -u maosha -p123456 meimei-prisma

# æ‰§è¡ŒSQLåˆ›å»ºè¡¨ï¼ˆè§ä¸Šé¢"æ•°æ®åº“è®¾è®¡"éƒ¨åˆ†çš„SQLï¼‰
```

#### æ­¥éª¤ 1.2ï¼šæ›´æ–°Prisma Schema
**æ–‡ä»¶**: `backend/meimei-prisma-vue3/meimei-admin/prisma/schema.prisma`

åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ä¸‰ä¸ªæ–°æ¨¡å‹ï¼š

```prisma
/// å‰ç«¯ç”¨æˆ·è¡¨
model Customer {
  customerId  Int       @id @default(autoincrement())
  userName    String    @unique @db.VarChar(50)
  nickName    String    @db.VarChar(50)
  email       String    @unique @db.VarChar(100)
  phonenumber String?   @db.VarChar(20)
  password    String    @db.VarChar(100)
  avatar      String?   @default("") @db.VarChar(200)
  sex         String?   @default("0") @db.Char(1)
  status      String?   @default("0") @db.Char(1)
  delFlag     String?   @default("0") @db.Char(1)
  loginIp     String?   @default("") @db.VarChar(128)
  loginDate   DateTime?
  createTime  DateTime? @default(now())
  updateTime  DateTime? @updatedAt
  remark      String?   @db.VarChar(500)

  @@index([status], map: "idx_customer_status")
  @@index([createTime], map: "idx_customer_createTime")
  @@map("customer")
}

/// å‰ç«¯ç”¨æˆ·ç™»å½•æ—¥å¿—è¡¨
model CustomerLoginLog {
  logId         Int       @id @default(autoincrement())
  customerId    Int?
  userName      String?   @default("") @db.VarChar(50)
  ipaddr        String?   @default("") @db.VarChar(128)
  loginLocation String?   @default("") @db.VarChar(255)
  browser       String?   @default("") @db.VarChar(50)
  os            String?   @default("") @db.VarChar(50)
  status        String?   @default("0") @db.Char(1)
  msg           String?   @default("") @db.VarChar(255)
  loginTime     DateTime? @default(now())

  @@index([customerId], map: "idx_customer_login_log_customerId")
  @@index([loginTime], map: "idx_customer_login_log_loginTime")
  @@map("customer_login_log")
}

/// å¯†ç é‡ç½®ä»¤ç‰Œè¡¨
model PasswordResetToken {
  tokenId    Int       @id @default(autoincrement())
  customerId Int
  email      String    @db.VarChar(100)
  token      String    @unique @db.VarChar(100)
  expiresAt  DateTime
  used       Int?      @default(0) @db.TinyInt
  createTime DateTime? @default(now())

  @@index([customerId], map: "idx_password_reset_token_customerId")
  @@index([expiresAt], map: "idx_password_reset_token_expiresAt")
  @@map("password_reset_token")
}
```

#### æ­¥éª¤ 1.3ï¼šç”ŸæˆPrisma Client
```bash
cd backend/meimei-prisma-vue3/meimei-admin
npx prisma generate
```

### é˜¶æ®µäºŒï¼šåç«¯APIå¼€å‘ï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰â­

#### æ­¥éª¤ 2.1ï¼šå¯ç”¨CORSè·¨åŸŸ
**æ–‡ä»¶**: `backend/meimei-prisma-vue3/meimei-admin/src/config/config.dev.ts`

```typescript
// ä¿®æ”¹ cors é…ç½®
cors: true,  // æ”¹ä¸º true
```

#### æ­¥éª¤ 2.2ï¼šåˆ›å»ºå‰ç«¯è®¤è¯æ¨¡å—ç›®å½•ç»“æ„
```bash
backend/meimei-prisma-vue3/meimei-admin/src/modules/
â””â”€â”€ frontend-auth/
    â”œâ”€â”€ frontend-auth.module.ts
    â”œâ”€â”€ frontend-auth.controller.ts
    â”œâ”€â”€ frontend-auth.service.ts
    â”œâ”€â”€ dto/
    â”‚   â”œâ”€â”€ req-register.dto.ts
    â”‚   â”œâ”€â”€ req-login.dto.ts
    â”‚   â”œâ”€â”€ req-update-profile.dto.ts
    â”‚   â”œâ”€â”€ req-change-password.dto.ts
    â”‚   â”œâ”€â”€ req-forgot-password.dto.ts
    â”‚   â””â”€â”€ req-reset-password.dto.ts
    â””â”€â”€ guards/
        â””â”€â”€ customer-jwt-auth.guard.ts
```

#### æ­¥éª¤ 2.3ï¼šåˆ›å»ºæ ¸å¿ƒæ–‡ä»¶ï¼ˆè¯¦ç»†ä»£ç è§é™„å½•ï¼‰

éœ€è¦åˆ›å»ºä»¥ä¸‹æ–‡ä»¶ï¼ˆå®Œæ•´ä»£ç è¾ƒé•¿ï¼Œè§æ–‡æ¡£æœ«å°¾é™„å½•ï¼‰ï¼š

1. **DTOæ–‡ä»¶**ï¼ˆ6ä¸ªï¼‰
   - `req-register.dto.ts` - æ³¨å†Œè¯·æ±‚éªŒè¯
   - `req-login.dto.ts` - ç™»å½•è¯·æ±‚éªŒè¯
   - `req-update-profile.dto.ts` - æ›´æ–°èµ„æ–™éªŒè¯
   - `req-change-password.dto.ts` - ä¿®æ”¹å¯†ç éªŒè¯
   - `req-forgot-password.dto.ts` - å¿˜è®°å¯†ç éªŒè¯
   - `req-reset-password.dto.ts` - é‡ç½®å¯†ç éªŒè¯

2. **Serviceæ–‡ä»¶**
   - `frontend-auth.service.ts` - ä¸šåŠ¡é€»è¾‘å®ç°

3. **Controlleræ–‡ä»¶**
   - `frontend-auth.controller.ts` - è·¯ç”±æ§åˆ¶å™¨

4. **Moduleæ–‡ä»¶**
   - `frontend-auth.module.ts` - æ¨¡å—å®šä¹‰

5. **Guardæ–‡ä»¶**
   - `customer-jwt-auth.guard.ts` - JWTè®¤è¯å®ˆå«

#### æ­¥éª¤ 2.4ï¼šæ³¨å†Œæ¨¡å—åˆ°ä¸»åº”ç”¨
**æ–‡ä»¶**: `backend/meimei-prisma-vue3/meimei-admin/src/app.module.ts`

åœ¨ `imports` æ•°ç»„ä¸­æ·»åŠ ï¼š
```typescript
import { FrontendAuthModule } from './modules/frontend-auth/frontend-auth.module';

@Module({
  imports: [
    // ... å…¶ä»–æ¨¡å—
    FrontendAuthModule,  // æ·»åŠ è¿™ä¸€è¡Œ
  ],
})
```

#### æ­¥éª¤ 2.5ï¼šå®‰è£…é‚®ä»¶å‘é€ä¾èµ–ï¼ˆæ‰¾å›å¯†ç åŠŸèƒ½ï¼‰
```bash
cd backend/meimei-prisma-vue3/meimei-admin
npm install nodemailer
npm install @types/nodemailer --save-dev
```

é…ç½®é‚®ä»¶æœåŠ¡ï¼ˆåœ¨ `config.dev.ts` ä¸­æ·»åŠ ï¼‰ï¼š
```typescript
// é‚®ä»¶é…ç½®
email: {
  host: 'smtp.qq.com',        // SMTPæœåŠ¡å™¨
  port: 587,                   // ç«¯å£
  secure: false,               // æ˜¯å¦ä½¿ç”¨SSL
  auth: {
    user: 'your-email@qq.com', // å‘ä»¶é‚®ç®±
    pass: 'your-smtp-password' // SMTPå¯†ç 
  }
}
```

### é˜¶æ®µä¸‰ï¼šå‰ç«¯é¡µé¢æ”¹é€ ï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰â­

#### æ­¥éª¤ 3.1ï¼šåˆ›å»ºå…¬å…±JavaScriptæ–‡ä»¶
**æ–‡ä»¶ä½ç½®**: `frontend/assets/js/auth.js`

**åŠŸèƒ½**:
- APIè¯·æ±‚å°è£…
- Tokenç®¡ç†ï¼ˆlocalStorageï¼‰
- ç”¨æˆ·çŠ¶æ€ç®¡ç†
- ç™»å½•çŠ¶æ€æ£€æŸ¥

**å®Œæ•´ä»£ç **:
```javascript
// auth.js - å‰ç«¯è®¤è¯æœåŠ¡
const API_BASE_URL = 'http://localhost:3000/api/frontend';

// å·¥å…·å‡½æ•°ï¼šæ˜¾ç¤ºæ¶ˆæ¯
function showMessage(message, type = 'info') {
  // å¯ä»¥ä½¿ç”¨æ›´å¥½çš„UIåº“ï¼Œè¿™é‡Œç®€å•å®ç°
  alert(message);
}

// Tokenç®¡ç†å’ŒAPIè°ƒç”¨æœåŠ¡
const AuthService = {
  // ========== Tokenç®¡ç† ==========

  setToken(token) {
    localStorage.setItem('customer_token', token);
  },

  getToken() {
    return localStorage.getItem('customer_token');
  },

  removeToken() {
    localStorage.removeItem('customer_token');
    localStorage.removeItem('customer_info');
  },

  isLoggedIn() {
    return !!this.getToken();
  },

  // ä¿å­˜ç”¨æˆ·ä¿¡æ¯
  setUserInfo(userInfo) {
    localStorage.setItem('customer_info', JSON.stringify(userInfo));
  },

  // è·å–ç”¨æˆ·ä¿¡æ¯
  getUserInfoFromStorage() {
    const info = localStorage.getItem('customer_info');
    return info ? JSON.parse(info) : null;
  },

  // ========== APIè°ƒç”¨ ==========

  // é€šç”¨è¯·æ±‚æ–¹æ³•
  async request(url, options = {}) {
    const token = this.getToken();
    const headers = {
      'Content-Type': 'application/json',
      ...options.headers
    };

    if (token && !options.noAuth) {
      headers['Authorization'] = `Bearer ${token}`;
    }

    try {
      const response = await fetch(`${API_BASE_URL}${url}`, {
        ...options,
        headers
      });

      const data = await response.json();

      // ç»Ÿä¸€å¤„ç†å“åº”
      if (data.code === 200) {
        return data;
      } else if (data.code === 401) {
        // Tokenè¿‡æœŸï¼Œæ¸…é™¤ç™»å½•çŠ¶æ€
        this.removeToken();
        showMessage('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•');
        setTimeout(() => {
          window.location.href = '/my-account/';
        }, 1500);
        throw new Error(data.msg);
      } else {
        throw new Error(data.msg || 'è¯·æ±‚å¤±è´¥');
      }
    } catch (error) {
      console.error('APIè¯·æ±‚é”™è¯¯:', error);
      throw error;
    }
  },

  // ç”¨æˆ·æ³¨å†Œ
  async register(userData) {
    const result = await this.request('/auth/register', {
      method: 'POST',
      body: JSON.stringify(userData),
      noAuth: true
    });

    if (result.data.token) {
      this.setToken(result.data.token);
      this.setUserInfo(result.data.user);
    }

    return result;
  },

  // ç”¨æˆ·ç™»å½•ï¼ˆæ— éœ€éªŒè¯ç ï¼‰
  async login(username, password, rememberMe = false) {
    const result = await this.request('/auth/login', {
      method: 'POST',
      body: JSON.stringify({ username, password, rememberMe }),
      noAuth: true
    });

    if (result.data.token) {
      this.setToken(result.data.token);
      this.setUserInfo(result.data.user);
    }

    return result;
  },

  // è·å–ç”¨æˆ·ä¿¡æ¯
  async getProfile() {
    const result = await this.request('/auth/profile', {
      method: 'GET'
    });

    if (result.data) {
      this.setUserInfo(result.data);
    }

    return result;
  },

  // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
  async updateProfile(profileData) {
    const result = await this.request('/auth/profile', {
      method: 'PUT',
      body: JSON.stringify(profileData)
    });

    // æ›´æ–°æˆåŠŸååˆ·æ–°ç”¨æˆ·ä¿¡æ¯
    await this.getProfile();

    return result;
  },

  // ä¿®æ”¹å¯†ç 
  async changePassword(oldPassword, newPassword, confirmPassword) {
    return await this.request('/auth/password', {
      method: 'PUT',
      body: JSON.stringify({ oldPassword, newPassword, confirmPassword })
    });
  },

  // é€€å‡ºç™»å½•
  async logout() {
    try {
      await this.request('/auth/logout', {
        method: 'POST'
      });
    } catch (error) {
      console.error('é€€å‡ºç™»å½•å¤±è´¥:', error);
    } finally {
      this.removeToken();
    }
  },

  // å¿˜è®°å¯†ç  - å‘é€é‚®ä»¶
  async forgotPassword(email) {
    return await this.request('/auth/forgot-password', {
      method: 'POST',
      body: JSON.stringify({ email }),
      noAuth: true
    });
  },

  // é‡ç½®å¯†ç 
  async resetPassword(token, newPassword, confirmPassword) {
    return await this.request('/auth/reset-password', {
      method: 'POST',
      body: JSON.stringify({ token, newPassword, confirmPassword }),
      noAuth: true
    });
  }
};

// å¯¼å‡ºä¾›å…¶ä»–é¡µé¢ä½¿ç”¨
if (typeof module !== 'undefined' && module.exports) {
  module.exports = AuthService;
}
```

#### æ­¥éª¤ 3.2ï¼šæ”¹é€ ç™»å½•é¡µé¢
**æ–‡ä»¶**: `frontend/my-account/index.html`

**ä¿®æ”¹æ­¥éª¤**:
1. åœ¨ `<head>` ä¸­å¼•å…¥ `auth.js`
2. æ·»åŠ éªŒè¯ç æ˜¾ç¤ºåŒºåŸŸ
3. æ·»åŠ é”™è¯¯æç¤ºåŒºåŸŸ
4. ç»‘å®šè¡¨å•æäº¤äº‹ä»¶

**å…³é”®ä¿®æ”¹ç‚¹**ï¼ˆåœ¨ç°æœ‰HTMLåŸºç¡€ä¸Šä¿®æ”¹ï¼‰:
```html
<!-- åœ¨ </head> å‰æ·»åŠ  -->
<script src="../assets/js/auth.js"></script>

<!-- æ·»åŠ é”™è¯¯æç¤º -->
<div id="errorMessage" style="color: #e74c3c; margin: 10px 0; display: none;"></div>

<!-- åœ¨ </body> å‰æ·»åŠ ç™»å½•é€»è¾‘ -->
<script>
(function() {
  // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
  function showError(message) {
    const errorDiv = document.getElementById('errorMessage');
    errorDiv.textContent = message;
    errorDiv.style.display = 'block';
    setTimeout(() => {
      errorDiv.style.display = 'none';
    }, 5000);
  }

  // è¡¨å•æäº¤
  const loginForm = document.querySelector('.woocommerce-form-login');
  loginForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    const username = document.querySelector('input[name="username"]').value.trim();
    const password = document.querySelector('input[name="password"]').value;
    const rememberMe = document.querySelector('input[name="rememberme"]')?.checked || false;

    if (!username || !password) {
      showError('è¯·å¡«å†™ç”¨æˆ·åå’Œå¯†ç ');
      return;
    }

    try {
      const result = await AuthService.login(username, password, rememberMe);

      if (result.code === 200) {
        // ç™»å½•æˆåŠŸï¼Œè·³è½¬åˆ°ä¸ªäººä¸­å¿ƒ
        window.location.href = '../Personal-Center/';
      }
    } catch (error) {
      showError(error.message || 'ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•');
    }
  });
})();
</script>
```

#### æ­¥éª¤ 3.3ï¼šæ”¹é€ æ³¨å†Œé¡µé¢
**æ–‡ä»¶**: `frontend/register/index.html`

**ä¿®æ”¹æ­¥éª¤**:
1. å¼•å…¥ `auth.js`
2. æ·»åŠ æ³¨å†Œè¡¨å•å­—æ®µ
3. ç»‘å®šæ³¨å†Œé€»è¾‘

**å…³é”®ä»£ç **:
```html
<!-- åœ¨ </head> å‰æ·»åŠ  -->
<script src="../assets/js/auth.js"></script>

<!-- æ³¨å†Œè¡¨å• -->
<form id="registerForm" class="woocommerce-form-register">
  <h2>Create an Account</h2>

  <p class="form-row">
    <label>Username *</label>
    <input type="text" name="userName" id="userName" required>
  </p>

  <p class="form-row">
    <label>Nickname *</label>
    <input type="text" name="nickName" id="nickName" required>
  </p>

  <p class="form-row">
    <label>Email *</label>
    <input type="email" name="email" id="email" required>
  </p>

  <p class="form-row">
    <label>Phone Number (Optional)</label>
    <input type="tel" name="phonenumber" id="phonenumber">
  </p>

  <p class="form-row">
    <label>Password * (At least 6 characters)</label>
    <input type="password" name="password" id="password" required minlength="6">
  </p>

  <p class="form-row">
    <label>Confirm Password *</label>
    <input type="password" name="confirmPassword" id="confirmPassword" required>
  </p>

  <p class="form-row">
    <button type="submit" class="button">REGISTER</button>
  </p>

  <p class="text-center">
    Already have an account? <a href="../my-account/">Sign in</a>
  </p>

  <div id="errorMessage" style="color: #e74c3c; margin: 10px 0; display: none;"></div>
</form>

<script>
(function() {
  function showError(message) {
    const errorDiv = document.getElementById('errorMessage');
    errorDiv.textContent = message;
    errorDiv.style.display = 'block';
    setTimeout(() => {
      errorDiv.style.display = 'none';
    }, 5000);
  }

  const registerForm = document.getElementById('registerForm');
  registerForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    const formData = {
      userName: document.getElementById('userName').value.trim(),
      nickName: document.getElementById('nickName').value.trim(),
      email: document.getElementById('email').value.trim(),
      phonenumber: document.getElementById('phonenumber').value.trim(),
      password: document.getElementById('password').value,
      confirmPassword: document.getElementById('confirmPassword').value
    };

    // å‰ç«¯éªŒè¯
    if (formData.password !== formData.confirmPassword) {
      showError('ä¸¤æ¬¡å¯†ç è¾“å…¥ä¸ä¸€è‡´');
      return;
    }

    if (formData.password.length < 6) {
      showError('å¯†ç è‡³å°‘éœ€è¦6ä¸ªå­—ç¬¦');
      return;
    }

    try {
      const result = await AuthService.register(formData);

      if (result.code === 200) {
        alert('æ³¨å†ŒæˆåŠŸï¼å³å°†è·³è½¬åˆ°ä¸ªäººä¸­å¿ƒ...');
        window.location.href = '../Personal-Center/';
      }
    } catch (error) {
      showError(error.message || 'æ³¨å†Œå¤±è´¥ï¼Œè¯·é‡è¯•');
    }
  });
})();
</script>
```

#### æ­¥éª¤ 3.4ï¼šæ”¹é€ ä¸ªäººä¸­å¿ƒé¡µé¢
**æ–‡ä»¶**: `frontend/Personal-Center/index.html`

**åŠŸèƒ½å®ç°**:
1. æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
2. ä¿®æ”¹ä¸ªäººèµ„æ–™è¡¨å•
3. ä¿®æ”¹å¯†ç è¡¨å•
4. é€€å‡ºç™»å½•æŒ‰é’®

**å…³é”®ä»£ç **:
```html
<!-- åœ¨ </head> å‰æ·»åŠ  -->
<script src="../assets/js/auth.js"></script>

<!-- ä¸ªäººä¿¡æ¯æ˜¾ç¤º -->
<div class="user-profile">
  <h2>Personal Information</h2>
  <div class="profile-info">
    <p><strong>Username:</strong> <span id="displayUserName"></span></p>
    <p><strong>Nickname:</strong> <span id="displayNickName"></span></p>
    <p><strong>Email:</strong> <span id="displayEmail"></span></p>
    <p><strong>Phone:</strong> <span id="displayPhone"></span></p>
  </div>

  <button id="logoutBtn" class="button">Logout</button>
</div>

<!-- ä¿®æ”¹èµ„æ–™è¡¨å• -->
<div class="edit-profile">
  <h3>Edit Profile</h3>
  <form id="updateProfileForm">
    <p class="form-row">
      <label>Nickname *</label>
      <input type="text" name="nickName" id="editNickName" required>
    </p>
    <p class="form-row">
      <label>Email *</label>
      <input type="email" name="email" id="editEmail" required>
    </p>
    <p class="form-row">
      <label>Phone</label>
      <input type="tel" name="phonenumber" id="editPhone">
    </p>
    <p class="form-row">
      <button type="submit" class="button">Update Profile</button>
    </p>
  </form>
</div>

<!-- ä¿®æ”¹å¯†ç è¡¨å• -->
<div class="change-password">
  <h3>Change Password</h3>
  <form id="changePasswordForm">
    <p class="form-row">
      <label>Current Password *</label>
      <input type="password" name="oldPassword" id="oldPassword" required>
    </p>
    <p class="form-row">
      <label>New Password *</label>
      <input type="password" name="newPassword" id="newPassword" required minlength="6">
    </p>
    <p class="form-row">
      <label>Confirm New Password *</label>
      <input type="password" name="confirmPassword" id="confirmNewPassword" required>
    </p>
    <p class="form-row">
      <button type="submit" class="button">Change Password</button>
    </p>
  </form>
</div>

<script>
(function() {
  // æ£€æŸ¥ç™»å½•çŠ¶æ€
  if (!AuthService.isLoggedIn()) {
    window.location.href = '../my-account/';
    return;
  }

  // åŠ è½½ç”¨æˆ·ä¿¡æ¯
  async function loadUserInfo() {
    try {
      const result = await AuthService.getProfile();
      const user = result.data;

      // æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
      document.getElementById('displayUserName').textContent = user.userName;
      document.getElementById('displayNickName').textContent = user.nickName;
      document.getElementById('displayEmail').textContent = user.email;
      document.getElementById('displayPhone').textContent = user.phonenumber || 'Not set';

      // å¡«å……ç¼–è¾‘è¡¨å•
      document.getElementById('editNickName').value = user.nickName;
      document.getElementById('editEmail').value = user.email;
      document.getElementById('editPhone').value = user.phonenumber || '';
    } catch (error) {
      console.error('åŠ è½½ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
    }
  }

  // æ›´æ–°èµ„æ–™
  document.getElementById('updateProfileForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const profileData = {
      nickName: document.getElementById('editNickName').value.trim(),
      email: document.getElementById('editEmail').value.trim(),
      phonenumber: document.getElementById('editPhone').value.trim()
    };

    try {
      await AuthService.updateProfile(profileData);
      alert('èµ„æ–™æ›´æ–°æˆåŠŸï¼');
      loadUserInfo(); // é‡æ–°åŠ è½½ä¿¡æ¯
    } catch (error) {
      alert(error.message || 'æ›´æ–°å¤±è´¥');
    }
  });

  // ä¿®æ”¹å¯†ç 
  document.getElementById('changePasswordForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const oldPassword = document.getElementById('oldPassword').value;
    const newPassword = document.getElementById('newPassword').value;
    const confirmPassword = document.getElementById('confirmNewPassword').value;

    if (newPassword !== confirmPassword) {
      alert('ä¸¤æ¬¡æ–°å¯†ç è¾“å…¥ä¸ä¸€è‡´');
      return;
    }

    try {
      await AuthService.changePassword(oldPassword, newPassword, confirmPassword);
      alert('å¯†ç ä¿®æ”¹æˆåŠŸï¼');
      document.getElementById('changePasswordForm').reset();
    } catch (error) {
      alert(error.message || 'ä¿®æ”¹å¤±è´¥');
    }
  });

  // é€€å‡ºç™»å½•
  document.getElementById('logoutBtn').addEventListener('click', async () => {
    if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
      await AuthService.logout();
      window.location.href = '../my-account/';
    }
  });

  // é¡µé¢åŠ è½½æ—¶åŠ è½½ç”¨æˆ·ä¿¡æ¯
  loadUserInfo();
})();
</script>
```

#### æ­¥éª¤ 3.5ï¼šæ”¹é€ æ‰¾å›å¯†ç é¡µé¢
**æ–‡ä»¶**: `frontend/my-account/lost-password/index.html`

**å…³é”®ä»£ç **:
```html
<script src="../../assets/js/auth.js"></script>

<form id="forgotPasswordForm">
  <p class="form-row">
    <label>Email Address *</label>
    <input type="email" name="email" id="email" required>
  </p>
  <p class="form-row">
    <button type="submit" class="button">Send Reset Link</button>
  </p>
</form>

<script>
document.getElementById('forgotPasswordForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const email = document.getElementById('email').value.trim();

  try {
    await AuthService.forgotPassword(email);
    alert('é‡ç½®å¯†ç é‚®ä»¶å·²å‘é€ï¼Œè¯·æŸ¥æ”¶ï¼');
  } catch (error) {
    alert(error.message || 'å‘é€å¤±è´¥');
  }
});
</script>
```

#### æ­¥éª¤ 3.6ï¼šæ”¹é€ æ‰€æœ‰é¡µé¢çš„é¡¶éƒ¨å¯¼èˆªæ 

åœ¨æ‰€æœ‰é¡µé¢çš„å¯¼èˆªæ ä¸­æ·»åŠ ç™»å½•çŠ¶æ€æ£€æŸ¥ï¼ˆéœ€è¦æ‰¾åˆ°é€šç”¨çš„headeréƒ¨åˆ†ï¼‰:

```html
<script src="/assets/js/auth.js"></script>
<script>
(function() {
  // æ£€æŸ¥ç™»å½•çŠ¶æ€å¹¶æ›´æ–°å¯¼èˆªæ 
  async function updateNavigation() {
    const signInLink = document.querySelector('.header-sign-in'); // æ ¹æ®å®é™…é€‰æ‹©å™¨è°ƒæ•´

    if (AuthService.isLoggedIn()) {
      try {
        const userInfo = AuthService.getUserInfoFromStorage();
        if (userInfo) {
          // å·²ç™»å½•ï¼šæ˜¾ç¤ºç”¨æˆ·åå’Œä¸‹æ‹‰èœå•
          signInLink.innerHTML = `
            <span>${userInfo.nickName}</span>
            <div class="user-dropdown">
              <a href="/Personal-Center/">Personal Center</a>
              <a href="#" id="navLogoutBtn">Logout</a>
            </div>
          `;

          document.getElementById('navLogoutBtn')?.addEventListener('click', async (e) => {
            e.preventDefault();
            await AuthService.logout();
            window.location.reload();
          });
        }
      } catch (error) {
        console.error('æ›´æ–°å¯¼èˆªæ å¤±è´¥:', error);
      }
    }
  }

  updateNavigation();
})();
</script>
```

### é˜¶æ®µå››ï¼šæµ‹è¯•ä¸ä¼˜åŒ–ï¼ˆä¼˜å…ˆçº§ï¼šä¸­ï¼‰â­

#### æµ‹è¯•æ¸…å•

**4.1 åŠŸèƒ½æµ‹è¯•**
- [ ] ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½
  - [ ] æ­£å¸¸æ³¨å†Œæµç¨‹
  - [ ] ç”¨æˆ·åé‡å¤æ£€æµ‹
  - [ ] é‚®ç®±é‡å¤æ£€æµ‹
  - [ ] å¯†ç ä¸ä¸€è‡´æç¤º
  - [ ] æ³¨å†Œåè‡ªåŠ¨ç™»å½•

- [ ] ç”¨æˆ·ç™»å½•åŠŸèƒ½
  - [ ] ç”¨æˆ·åç™»å½•
  - [ ] é‚®ç®±ç™»å½•
  - [ ] è®°ä½æˆ‘åŠŸèƒ½
  - [ ] é”™è¯¯å¯†ç æç¤º
  - [ ] è´¦å·ç¦ç”¨æç¤º

- [ ] ç”¨æˆ·ä¿¡æ¯ç®¡ç†
  - [ ] æŸ¥çœ‹ä¸ªäººä¿¡æ¯
  - [ ] ä¿®æ”¹æ˜µç§°
  - [ ] ä¿®æ”¹é‚®ç®±
  - [ ] ä¿®æ”¹æ‰‹æœºå·
  - [ ] ä¿®æ”¹å¯†ç 

- [ ] é€€å‡ºç™»å½•
  - [ ] æ­£å¸¸é€€å‡º
  - [ ] Tokenæ¸…é™¤
  - [ ] è·³è½¬åˆ°ç™»å½•é¡µ

- [ ] æ‰¾å›å¯†ç 
  - [ ] å‘é€é‡ç½®é‚®ä»¶
  - [ ] éªŒè¯é‡ç½®ä»¤ç‰Œ
  - [ ] é‡ç½®å¯†ç æˆåŠŸ

**4.2 å®‰å…¨æ€§æµ‹è¯•**
- [ ] SQLæ³¨å…¥é˜²æŠ¤
- [ ] XSSæ”»å‡»é˜²æŠ¤
- [ ] CSRFé˜²æŠ¤
- [ ] Tokenè¿‡æœŸå¤„ç†
- [ ] å¯†ç åŠ å¯†éªŒè¯
- [ ] ç™»å½•å¤±è´¥å¤„ç†ï¼ˆå¯é€‰ï¼šæ·»åŠ å¤±è´¥æ¬¡æ•°é™åˆ¶ï¼‰

**4.3 æ€§èƒ½æµ‹è¯•**
- [ ] APIå“åº”æ—¶é—´
- [ ] å¹¶å‘ç™»å½•æµ‹è¯•
- [ ] æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–

**4.4 å…¼å®¹æ€§æµ‹è¯•**
- [ ] Chromeæµè§ˆå™¨
- [ ] Firefoxæµè§ˆå™¨
- [ ] Safariæµè§ˆå™¨
- [ ] Edgeæµè§ˆå™¨
- [ ] ç§»åŠ¨ç«¯æµè§ˆå™¨

## ğŸ”’ å®‰å…¨è€ƒè™‘

### 1. å¯†ç å®‰å…¨
- âœ… ä½¿ç”¨ **bcrypt** åŠ å¯†ï¼ˆsalt rounds: 10ï¼‰
- âœ… æœ€å°é•¿åº¦ **6ä½**
- âœ… å»ºè®®åŒ…å«å¤§å°å†™å­—æ¯å’Œæ•°å­—
- âœ… å¯†ç ä¸åœ¨å“åº”ä¸­è¿”å›

### 2. Tokenå®‰å…¨
- âœ… ä½¿ç”¨ **JWT** token
- âœ… é»˜è®¤è¿‡æœŸæ—¶é—´ï¼š**7å¤©**
- âœ… è®°ä½æˆ‘ï¼š**30å¤©**
- âœ… å­˜å‚¨åœ¨ **localStorage**
- âœ… æ¯æ¬¡è¯·æ±‚æºå¸¦åœ¨ **Authorization header**
- âœ… Tokenå­˜å‚¨åœ¨Redisï¼Œæ”¯æŒä¸»åŠ¨æ³¨é”€

### 3. CORSé…ç½®
- âœ… å…è®¸å‰ç«¯åŸŸåè®¿é—®ï¼ˆlocalhost:8080ï¼‰
- âœ… é…ç½®å…è®¸çš„HTTPæ–¹æ³•ï¼ˆGET, POST, PUT, DELETEï¼‰
- âœ… é…ç½®å…è®¸çš„è¯·æ±‚å¤´ï¼ˆAuthorization, Content-Typeï¼‰
- âœ… ç”Ÿäº§ç¯å¢ƒé…ç½®å®é™…åŸŸå

### 4. æ•°æ®éªŒè¯
- âœ… åç«¯ä½¿ç”¨ **class-validator** è¿›è¡Œå‚æ•°éªŒè¯
- âœ… å‰ç«¯è¿›è¡ŒåŸºç¡€éªŒè¯
- âœ… é‚®ç®±æ ¼å¼éªŒè¯
- âœ… æ‰‹æœºå·æ ¼å¼éªŒè¯ï¼ˆå¯é€‰ï¼‰

### 5. é˜²æ­¢é‡å¤æäº¤
- âœ… æ³¨å†Œ/ç™»å½•æŒ‰é’®é˜²é‡å¤ç‚¹å‡»
- âœ… åç«¯æ¥å£å¹‚ç­‰æ€§è®¾è®¡

### 6. é˜²æš´åŠ›ç ´è§£ï¼ˆå·²å®æ–½ï¼‰
- âœ… **ç™»å½•å¤±è´¥æ¬¡æ•°é™åˆ¶**ï¼š5æ¬¡å¤±è´¥åé”å®šè´¦å·10åˆ†é’Ÿ
- âœ… å¤±è´¥æ¬¡æ•°å­˜å‚¨åœ¨Redisä¸­
- âœ… é”å®šæœŸé—´ç¦æ­¢ç™»å½•
- âš ï¸ å¯é€‰ï¼šIPé™æµï¼ˆé˜²æ­¢åŒä¸€IPé¢‘ç¹è¯·æ±‚ï¼‰
- âš ï¸ å¯é€‰ï¼šæ·»åŠ å›¾å½¢éªŒè¯ç æˆ–æ»‘å—éªŒè¯

## ğŸ“¦ ä¾èµ–åŒ…æ¸…å•

### åç«¯ä¾èµ–
```bash
# å·²æœ‰ä¾èµ–ï¼ˆæ— éœ€å®‰è£…ï¼‰
- @nestjs/common
- @nestjs/core
- @nestjs/jwt
- @nestjs/passport
- @prisma/client
- bcrypt
- passport-jwt
- class-validator
- class-transformer

# éœ€è¦æ–°å®‰è£…çš„ä¾èµ–
npm install nodemailer
npm install @types/nodemailer --save-dev
```

### å‰ç«¯ä¾èµ–
```html
<!-- æ— éœ€é¢å¤–å®‰è£…ï¼Œä½¿ç”¨åŸç”ŸJavaScript -->
<!-- å·²æœ‰jQueryå¯é€‰ç”¨ -->
<script src="./wp-includes/js/jquery/jquery.min.js"></script>
```

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### å¼€å‘ç¯å¢ƒéƒ¨ç½²

1. **å¯åŠ¨MySQLæ•°æ®åº“**
   ```bash
   # ç¡®ä¿MySQLæœåŠ¡è¿è¡Œ
   # æ•°æ®åº“ï¼šmeimei-prisma
   # ç”¨æˆ·ï¼šmaosha
   # å¯†ç ï¼š123456
   ```

2. **å¯åŠ¨Redis**
   ```bash
   # ç¡®ä¿RedisæœåŠ¡è¿è¡Œ
   # ç«¯å£ï¼š6379
   # å¯†ç ï¼š123456
   ```

3. **åˆ›å»ºæ•°æ®åº“è¡¨**
   ```bash
   # æ‰§è¡ŒSQLåˆ›å»ºcustomerã€customer_login_logã€password_reset_tokenè¡¨
   mysql -u maosha -p123456 meimei-prisma < create_tables.sql
   ```

4. **æ›´æ–°Prisma Schemaå¹¶ç”ŸæˆClient**
   ```bash
   cd backend/meimei-prisma-vue3/meimei-admin
   npx prisma generate
   ```

5. **å¯åŠ¨åç«¯APIæœåŠ¡**
   ```bash
   cd backend/meimei-prisma-vue3/meimei-admin
   npm run dev
   # è¿è¡Œåœ¨ http://localhost:3000
   ```

6. **å¯åŠ¨å‰ç«¯æœåŠ¡**
   ```bash
   cd frontend
   node server.js
   # è¿è¡Œåœ¨ http://localhost:8080
   ```

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

1. **ç¯å¢ƒå˜é‡é…ç½®**
   ```bash
   # .env æ–‡ä»¶
   DATABASE_URL="mysql://user:password@host:3306/database"
   NODE_PORT=3000
   NODE_REDIS_HOST=localhost
   NODE_REDIS_PORT=6379
   NODE_REDIS_PASSWORD=your-redis-password

   # é‚®ä»¶é…ç½®
   EMAIL_HOST=smtp.example.com
   EMAIL_PORT=587
   EMAIL_USER=your-email@example.com
   EMAIL_PASSWORD=your-email-password
   ```

2. **CORSé…ç½®**
   ```typescript
   // config.pro.ts
   cors: {
     origin: ['https://your-domain.com'],
     credentials: true
   }
   ```

3. **HTTPSé…ç½®**
   - é…ç½®SSLè¯ä¹¦
   - ä½¿ç”¨Nginxåå‘ä»£ç†
   - å¼ºåˆ¶HTTPSé‡å®šå‘

4. **å‰ç«¯é…ç½®**
   ```javascript
   // auth.js
   const API_BASE_URL = 'https://api.your-domain.com/api/frontend';
   ```

## ï¿½ æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–

```sql
-- customerè¡¨ç´¢å¼•
CREATE INDEX idx_customer_status ON customer(status);
CREATE INDEX idx_customer_createTime ON customer(createTime);
CREATE INDEX idx_customer_email ON customer(email);

-- customer_login_logè¡¨ç´¢å¼•
CREATE INDEX idx_customer_login_log_customerId ON customer_login_log(customerId);
CREATE INDEX idx_customer_login_log_loginTime ON customer_login_log(loginTime);

-- password_reset_tokenè¡¨ç´¢å¼•
CREATE INDEX idx_password_reset_token_customerId ON password_reset_token(customerId);
CREATE INDEX idx_password_reset_token_expiresAt ON password_reset_token(expiresAt);
CREATE INDEX idx_password_reset_token_token ON password_reset_token(token);
```

## ğŸ¯ åç»­æ‰©å±•åŠŸèƒ½å»ºè®®

1. **ç¤¾äº¤ç™»å½•**
   - Googleç™»å½•
   - Facebookç™»å½•
   - å¾®ä¿¡ç™»å½•

2. **æ‰‹æœºéªŒè¯ç ç™»å½•**
   - çŸ­ä¿¡éªŒè¯ç 
   - æ‰‹æœºå·å¿«æ·ç™»å½•

3. **ç”¨æˆ·ç­‰çº§ç³»ç»Ÿ**
   - ç§¯åˆ†ç³»ç»Ÿ
   - ä¼šå‘˜ç­‰çº§
   - ä¼˜æƒ åˆ¸

4. **è®¢å•ç®¡ç†**
   - è®¢å•åˆ—è¡¨
   - è®¢å•è¯¦æƒ…
   - è®¢å•çŠ¶æ€è·Ÿè¸ª

5. **æ”¶è´§åœ°å€ç®¡ç†**
   - å¤šåœ°å€ç®¡ç†
   - é»˜è®¤åœ°å€è®¾ç½®

## ï¿½ğŸ“ æŠ€æœ¯æ”¯æŒä¸å‚è€ƒæ–‡æ¡£

### å®˜æ–¹æ–‡æ¡£
- **NestJS**: https://docs.nestjs.com/
- **Prisma**: https://www.prisma.io/docs/
- **JWT**: https://jwt.io/
- **bcrypt**: https://github.com/kelektiv/node.bcrypt.js
- **nodemailer**: https://nodemailer.com/

### å¸¸è§é—®é¢˜

**Q1: CORSé”™è¯¯æ€ä¹ˆåŠï¼Ÿ**
A: ç¡®ä¿ `config.dev.ts` ä¸­ `cors: true`ï¼Œå¹¶é‡å¯åç«¯æœåŠ¡ã€‚

**Q2: Tokenè¿‡æœŸåå¦‚ä½•å¤„ç†ï¼Ÿ**
A: å‰ç«¯ä¼šè‡ªåŠ¨æ£€æµ‹401é”™è¯¯ï¼Œæ¸…é™¤tokenå¹¶è·³è½¬åˆ°ç™»å½•é¡µã€‚

**Q3: å¦‚ä½•ä¿®æ”¹Tokenè¿‡æœŸæ—¶é—´ï¼Ÿ**
A: ä¿®æ”¹ `config.dev.ts` ä¸­çš„ `expiresIn` å€¼ï¼ˆå•ä½ï¼šç§’ï¼‰ã€‚

**Q4: é‚®ä»¶å‘é€å¤±è´¥ï¼Ÿ**
A: æ£€æŸ¥é‚®ä»¶æœåŠ¡é…ç½®ï¼Œç¡®ä¿SMTPæœåŠ¡å™¨åœ°å€ã€ç«¯å£ã€è´¦å·å¯†ç æ­£ç¡®ã€‚

**Q5: æ•°æ®åº“è¿æ¥å¤±è´¥ï¼Ÿ**
A: æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„ `DATABASE_URL` é…ç½®æ˜¯å¦æ­£ç¡®ã€‚

## ğŸ“‹ å®æ–½æ£€æŸ¥æ¸…å•

### åç«¯å¼€å‘
- [ ] åˆ›å»ºæ•°æ®åº“è¡¨ï¼ˆcustomer, customer_login_log, password_reset_tokenï¼‰
- [ ] æ›´æ–°Prisma Schema
- [ ] ç”ŸæˆPrisma Client
- [ ] å¯ç”¨CORSé…ç½®
- [ ] åˆ›å»ºfrontend-authæ¨¡å—
- [ ] å®ç°æ³¨å†Œæ¥å£
- [ ] å®ç°ç™»å½•æ¥å£ï¼ˆæ— éœ€éªŒè¯ç ï¼‰
- [ ] å®ç°è·å–ç”¨æˆ·ä¿¡æ¯æ¥å£
- [ ] å®ç°æ›´æ–°ç”¨æˆ·ä¿¡æ¯æ¥å£
- [ ] å®ç°ä¿®æ”¹å¯†ç æ¥å£
- [ ] å®ç°é€€å‡ºç™»å½•æ¥å£
- [ ] å®ç°æ‰¾å›å¯†ç æ¥å£ï¼ˆå‘é€é‚®ä»¶ + é‡ç½®å¯†ç ï¼‰
- [ ] é…ç½®é‚®ä»¶æœåŠ¡
- [ ] æµ‹è¯•æ‰€æœ‰APIæ¥å£

### å‰ç«¯å¼€å‘
- [ ] åˆ›å»ºauth.jså…¬å…±æ–‡ä»¶
- [ ] æ”¹é€ ç™»å½•é¡µé¢
- [ ] æ”¹é€ æ³¨å†Œé¡µé¢
- [ ] æ”¹é€ ä¸ªäººä¸­å¿ƒé¡µé¢
- [ ] æ”¹é€ æ‰¾å›å¯†ç é¡µé¢
- [ ] æ”¹é€ æ‰€æœ‰é¡µé¢å¯¼èˆªæ 
- [ ] æµ‹è¯•æ‰€æœ‰é¡µé¢åŠŸèƒ½
- [ ] ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ
- [ ] æ·»åŠ åŠ è½½åŠ¨ç”»
- [ ] ä¼˜åŒ–é”™è¯¯æç¤º

### æµ‹è¯•ä¸éƒ¨ç½²
- [ ] åŠŸèƒ½æµ‹è¯•
- [ ] å®‰å…¨æ€§æµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•
- [ ] å…¼å®¹æ€§æµ‹è¯•
- [ ] ç”Ÿäº§ç¯å¢ƒé…ç½®
- [ ] éƒ¨ç½²ä¸Šçº¿

---

## ğŸ›ï¸ åå°ç®¡ç†é¡µé¢ - å‰ç«¯ç”¨æˆ·ç®¡ç†æ¨¡å—

### åŠŸèƒ½è¯´æ˜

åœ¨åå°ç®¡ç†ç³»ç»Ÿï¼ˆVue3ç®¡ç†ç•Œé¢ï¼‰ä¸­æ·»åŠ "å‰ç«¯ç”¨æˆ·ç®¡ç†"æ¨¡å—ï¼Œç”¨äºç®¡ç†çŒ«ç ‚ç½‘ç«™çš„å‰ç«¯ç”¨æˆ·ï¼ˆcustomerè¡¨ï¼‰ã€‚å‚è€ƒç°æœ‰çš„"ç”¨æˆ·ç®¡ç†"æ¨¡å—ï¼ˆsystem/userï¼‰ï¼Œä½†ä½¿ç”¨customerè¡¨çš„å­—æ®µã€‚

### åŠŸèƒ½åˆ—è¡¨

1. **ç”¨æˆ·åˆ—è¡¨å±•ç¤º**
   - æ˜¾ç¤ºæ‰€æœ‰å‰ç«¯ç”¨æˆ·
   - æ”¯æŒåˆ†é¡µã€æœç´¢ã€ç­›é€‰
   - æ˜¾ç¤ºå­—æ®µï¼šç”¨æˆ·IDã€ç”¨æˆ·åã€æ˜µç§°ã€é‚®ç®±ã€æ‰‹æœºå·ã€æ€§åˆ«ã€çŠ¶æ€ã€æ³¨å†Œæ—¶é—´ã€æœ€åç™»å½•æ—¶é—´

2. **ç”¨æˆ·è¯¦æƒ…æŸ¥çœ‹**
   - æŸ¥çœ‹ç”¨æˆ·å®Œæ•´ä¿¡æ¯
   - æŸ¥çœ‹ç™»å½•æ—¥å¿—

3. **ç”¨æˆ·çŠ¶æ€ç®¡ç†**
   - å¯ç”¨/ç¦ç”¨ç”¨æˆ·è´¦å·ï¼ˆåˆ‡æ¢å¼€å…³ï¼‰
   - é‡ç½®ç”¨æˆ·å¯†ç 
   - åˆ é™¤ç”¨æˆ·ï¼ˆè½¯åˆ é™¤ï¼‰

4. **ç”¨æˆ·æœç´¢ä¸ç­›é€‰**
   - æŒ‰ç”¨æˆ·åæœç´¢
   - æŒ‰é‚®ç®±æœç´¢
   - æŒ‰æ‰‹æœºå·æœç´¢
   - æŒ‰çŠ¶æ€ç­›é€‰ï¼ˆæ­£å¸¸/ç¦ç”¨ï¼‰
   - æŒ‰æ³¨å†Œæ—¶é—´èŒƒå›´ç­›é€‰

5. **æ‰¹é‡æ“ä½œ**
   - æ‰¹é‡åˆ é™¤ç”¨æˆ·
   - æ‰¹é‡å¯ç”¨/ç¦ç”¨

### æ•°æ®åº“è¡¨å­—æ®µæ˜ å°„

å‚è€ƒ `sys_user` è¡¨ï¼Œä½¿ç”¨ `customer` è¡¨çš„å­—æ®µï¼š

| åå°ç®¡ç†ç”¨æˆ·è¡¨ (sys_user) | å‰ç«¯ç”¨æˆ·è¡¨ (customer) | è¯´æ˜ |
|--------------------------|---------------------|------|
| userId | customerId | ç”¨æˆ·IDï¼ˆä¸»é”®ï¼‰ |
| userName | userName | ç”¨æˆ·åï¼ˆå”¯ä¸€ï¼‰ |
| nickName | nickName | æ˜µç§° |
| email | email | é‚®ç®±ï¼ˆå”¯ä¸€ï¼‰ |
| phonenumber | phonenumber | æ‰‹æœºå· |
| password | password | å¯†ç ï¼ˆbcryptåŠ å¯†ï¼‰ |
| sex | sex | æ€§åˆ«ï¼ˆ0-æœªçŸ¥ï¼Œ1-ç”·ï¼Œ2-å¥³ï¼‰ |
| avatar | avatar | å¤´åƒURL |
| status | status | çŠ¶æ€ï¼ˆ0-æ­£å¸¸ï¼Œ1-ç¦ç”¨ï¼‰ |
| delFlag | delFlag | åˆ é™¤æ ‡å¿—ï¼ˆ0-æœªåˆ é™¤ï¼Œ1-å·²åˆ é™¤ï¼‰ |
| loginIp | loginIp | æœ€åç™»å½•IP |
| loginDate | loginDate | æœ€åç™»å½•æ—¶é—´ |
| createTime | createTime | åˆ›å»ºæ—¶é—´ |
| updateTime | updateTime | æ›´æ–°æ—¶é—´ |
| remark | remark | å¤‡æ³¨ |
| deptId | âŒ æ—  | å‰ç«¯ç”¨æˆ·æ— éƒ¨é—¨æ¦‚å¿µ |
| postIds | âŒ æ—  | å‰ç«¯ç”¨æˆ·æ— å²—ä½æ¦‚å¿µ |
| roleIds | âŒ æ—  | å‰ç«¯ç”¨æˆ·æ— è§’è‰²æ¦‚å¿µ |

### åç«¯APIæ¥å£ï¼ˆéœ€æ–°å¢ï¼‰

**æ¨¡å—è·¯å¾„**: `backend/meimei-prisma-vue3/meimei-admin/src/modules/customer-admin/`

#### 1. è·å–å‰ç«¯ç”¨æˆ·åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰
```typescript
GET /system/customer/list
Queryå‚æ•°:
  - pageNum: number (é¡µç )
  - pageSize: number (æ¯é¡µæ•°é‡)
  - userName?: string (ç”¨æˆ·åï¼Œæ¨¡ç³Šæœç´¢)
  - email?: string (é‚®ç®±ï¼Œæ¨¡ç³Šæœç´¢)
  - phonenumber?: string (æ‰‹æœºå·ï¼Œæ¨¡ç³Šæœç´¢)
  - status?: string (çŠ¶æ€ï¼š0-æ­£å¸¸ï¼Œ1-ç¦ç”¨)
  - params?: {
      beginTime?: string (å¼€å§‹æ—¶é—´)
      endTime?: string (ç»“æŸæ—¶é—´)
    }

Response:
{
  "rows": [
    {
      "customerId": 1,
      "userName": "john_doe",
      "nickName": "John",
      "email": "john@example.com",
      "phonenumber": "13800138000",
      "sex": "1",
      "status": "0",
      "loginIp": "192.168.1.1",
      "loginDate": "2025-11-04 10:30:00",
      "createTime": "2025-11-01 08:00:00"
    }
  ],
  "total": 100
}
```

#### 2. è·å–ç”¨æˆ·è¯¦æƒ…
```typescript
GET /system/customer/:customerId

Response:
{
  "customerId": 1,
  "userName": "john_doe",
  "nickName": "John",
  "email": "john@example.com",
  "phonenumber": "13800138000",
  "avatar": "http://example.com/avatar.jpg",
  "sex": "1",
  "status": "0",
  "loginIp": "192.168.1.1",
  "loginDate": "2025-11-04 10:30:00",
  "createTime": "2025-11-01 08:00:00",
  "updateTime": "2025-11-04 10:30:00",
  "remark": "VIPç”¨æˆ·"
}
```

#### 3. æ›´æ–°ç”¨æˆ·çŠ¶æ€
```typescript
PUT /system/customer/changeStatus
Body: {
  "customerId": 1,
  "status": "0" // 0-æ­£å¸¸ï¼Œ1-ç¦ç”¨
}

Response: { "msg": "æ“ä½œæˆåŠŸ" }
```

#### 4. é‡ç½®ç”¨æˆ·å¯†ç 
```typescript
PUT /system/customer/resetPwd
Body: {
  "customerId": 1,
  "password": "123456" // æ–°å¯†ç 
}

Response: { "msg": "å¯†ç é‡ç½®æˆåŠŸ" }
```

#### 5. åˆ é™¤ç”¨æˆ·ï¼ˆè½¯åˆ é™¤ï¼‰
```typescript
DELETE /system/customer/:customerId

Response: { "msg": "åˆ é™¤æˆåŠŸ" }
```

#### 6. æ‰¹é‡åˆ é™¤ç”¨æˆ·
```typescript
DELETE /system/customer/:customerIds
// customerIds: "1,2,3"

Response: { "msg": "åˆ é™¤æˆåŠŸ" }
```

#### 7. è·å–ç”¨æˆ·ç™»å½•æ—¥å¿—
```typescript
GET /system/customer/:customerId/loginLogs
Queryå‚æ•°:
  - pageNum: number
  - pageSize: number

Response:
{
  "rows": [
    {
      "logId": 1,
      "customerId": 1,
      "userName": "john_doe",
      "loginIp": "192.168.1.1",
      "loginLocation": "ä¸­å›½-åŒ—äº¬",
      "browser": "Chrome",
      "os": "Windows 10",
      "status": "0",
      "msg": "ç™»å½•æˆåŠŸ",
      "loginTime": "2025-11-04 10:30:00"
    }
  ],
  "total": 50
}
```

### å‰ç«¯é¡µé¢å¼€å‘

#### 1. é¡µé¢æ–‡ä»¶ç»“æ„

```
backend/meimei-prisma-vue3/meimei-ui-vue3/src/views/system/customer/
â”œâ”€â”€ index.vue           # å‰ç«¯ç”¨æˆ·åˆ—è¡¨é¡µé¢
â””â”€â”€ loginLog.vue        # ç™»å½•æ—¥å¿—æŸ¥çœ‹é¡µé¢ï¼ˆå¯é€‰ï¼‰
```

#### 2. APIæ¥å£æ–‡ä»¶

**æ–‡ä»¶ä½ç½®**: `backend/meimei-prisma-vue3/meimei-ui-vue3/src/api/system/customer.js`

```javascript
import request from '@/utils/request'

// æŸ¥è¯¢å‰ç«¯ç”¨æˆ·åˆ—è¡¨
export function listCustomer(query) {
  return request({
    url: '/system/customer/list',
    method: 'get',
    params: query
  })
}

// æŸ¥è¯¢å‰ç«¯ç”¨æˆ·è¯¦ç»†
export function getCustomer(customerId) {
  return request({
    url: '/system/customer/' + customerId,
    method: 'get'
  })
}

// ä¿®æ”¹å‰ç«¯ç”¨æˆ·çŠ¶æ€
export function changeCustomerStatus(customerId, status) {
  const data = {
    customerId,
    status
  }
  return request({
    url: '/system/customer/changeStatus',
    method: 'put',
    data: data
  })
}

// åˆ é™¤å‰ç«¯ç”¨æˆ·
export function delCustomer(customerId) {
  return request({
    url: '/system/customer/' + customerId,
    method: 'delete'
  })
}

// é‡ç½®å‰ç«¯ç”¨æˆ·å¯†ç 
export function resetCustomerPwd(customerId, password) {
  const data = {
    customerId,
    password
  }
  return request({
    url: '/system/customer/resetPwd',
    method: 'put',
    data: data
  })
}

// æŸ¥è¯¢å‰ç«¯ç”¨æˆ·ç™»å½•æ—¥å¿—
export function getCustomerLoginLogs(customerId, query) {
  return request({
    url: '/system/customer/' + customerId + '/loginLogs',
    method: 'get',
    params: query
  })
}
```

#### 3. é¡µé¢ç»„ä»¶ä»£ç ç»“æ„

**æ–‡ä»¶**: `backend/meimei-prisma-vue3/meimei-ui-vue3/src/views/system/customer/index.vue`

å‚è€ƒ `backend/meimei-prisma-vue3/meimei-ui-vue3/src/views/system/user/index.vue`ï¼Œä¸»è¦ä¿®æ”¹ï¼š

1. **ç§»é™¤éƒ¨é—¨ç›¸å…³åŠŸèƒ½**
   - åˆ é™¤å·¦ä¾§éƒ¨é—¨æ ‘ç»„ä»¶
   - åˆ é™¤éƒ¨é—¨é€‰æ‹©ä¸‹æ‹‰æ¡†
   - åˆ é™¤éƒ¨é—¨ç›¸å…³çš„æŸ¥è¯¢æ¡ä»¶

2. **è°ƒæ•´è¡¨æ ¼åˆ—**
   ```javascript
   const columns = ref([
     { dataKey: 'customerId', key: 'customerId', title: 'ç”¨æˆ·ç¼–å·', width: 100 },
     { dataKey: 'userName', key: 'userName', title: 'ç”¨æˆ·å', width: 150 },
     { dataKey: 'nickName', key: 'nickName', title: 'æ˜µç§°', width: 150 },
     { dataKey: 'email', key: 'email', title: 'é‚®ç®±', width: 200 },
     { dataKey: 'phonenumber', key: 'phonenumber', title: 'æ‰‹æœºå·', width: 130 },
     { dataKey: 'sex', key: 'sex', title: 'æ€§åˆ«', width: 80, cellRenderer: 'sex' },
     { dataKey: 'status', key: 'status', title: 'çŠ¶æ€', width: 100, cellRenderer: 'status' },
     { dataKey: 'loginDate', key: 'loginDate', title: 'æœ€åç™»å½•', width: 180, cellRenderer: 'loginDate' },
     { dataKey: 'createTime', key: 'createTime', title: 'æ³¨å†Œæ—¶é—´', width: 180, cellRenderer: 'createTime' },
     { dataKey: 'operate', key: 'operate', title: 'æ“ä½œ', width: 200, cellRenderer: 'operate', fixed: 'right' }
   ])
   ```

3. **è°ƒæ•´è¡¨å•å­—æ®µ**
   - ç§»é™¤éƒ¨é—¨ã€å²—ä½ã€è§’è‰²é€‰æ‹©
   - ä¿ç•™ï¼šç”¨æˆ·åã€æ˜µç§°ã€é‚®ç®±ã€æ‰‹æœºå·ã€æ€§åˆ«ã€çŠ¶æ€ã€å¤‡æ³¨

4. **è°ƒæ•´æ“ä½œæŒ‰é’®**
   - æŸ¥çœ‹è¯¦æƒ…
   - é‡ç½®å¯†ç 
   - æŸ¥çœ‹ç™»å½•æ—¥å¿—
   - åˆ é™¤

### èœå•é…ç½®

#### æ–¹å¼ä¸€ï¼šé€šè¿‡æ•°æ®åº“ç›´æ¥æ’å…¥èœå•

```sql
-- 1. æ’å…¥"å‰ç«¯ç”¨æˆ·ç®¡ç†"èœå•ï¼ˆå‡è®¾ç³»ç»Ÿç®¡ç†çš„menuIdä¸º1ï¼‰
INSERT INTO `sys_menu` (
  `menuName`, `parentId`, `orderNum`, `path`, `component`,
  `menuType`, `visible`, `status`, `perms`, `icon`,
  `createTime`, `remark`
) VALUES (
  'å‰ç«¯ç”¨æˆ·ç®¡ç†',  -- èœå•åç§°
  1,               -- çˆ¶èœå•IDï¼ˆç³»ç»Ÿç®¡ç†ï¼‰
  2,               -- æ’åºï¼ˆåœ¨ç”¨æˆ·ç®¡ç†ä¹‹åï¼‰
  'customer',      -- è·¯ç”±åœ°å€
  'system/customer/index',  -- ç»„ä»¶è·¯å¾„
  'C',             -- èœå•ç±»å‹ï¼šC-èœå•
  '0',             -- æ˜¯å¦æ˜¾ç¤ºï¼š0-æ˜¾ç¤º
  '0',             -- çŠ¶æ€ï¼š0-æ­£å¸¸
  'system:customer:list',  -- æƒé™æ ‡è¯†
  'peoples',       -- å›¾æ ‡
  NOW(),           -- åˆ›å»ºæ—¶é—´
  'å‰ç«¯ç”¨æˆ·ç®¡ç†èœå•'  -- å¤‡æ³¨
);

-- 2. è·å–åˆšæ’å…¥çš„èœå•ID
SET @customerMenuId = LAST_INSERT_ID();

-- 3. æ’å…¥"å‰ç«¯ç”¨æˆ·ç®¡ç†"çš„æŒ‰é’®æƒé™
INSERT INTO `sys_menu` (`menuName`, `parentId`, `orderNum`, `menuType`, `visible`, `status`, `perms`, `createTime`) VALUES
('å‰ç«¯ç”¨æˆ·æŸ¥è¯¢', @customerMenuId, 1, 'F', '0', '0', 'system:customer:query', NOW()),
('å‰ç«¯ç”¨æˆ·æ–°å¢', @customerMenuId, 2, 'F', '0', '0', 'system:customer:add', NOW()),
('å‰ç«¯ç”¨æˆ·ä¿®æ”¹', @customerMenuId, 3, 'F', '0', '0', 'system:customer:edit', NOW()),
('å‰ç«¯ç”¨æˆ·åˆ é™¤', @customerMenuId, 4, 'F', '0', '0', 'system:customer:remove', NOW()),
('é‡ç½®å¯†ç ', @customerMenuId, 5, 'F', '0', '0', 'system:customer:resetPwd', NOW()),
('æŸ¥çœ‹ç™»å½•æ—¥å¿—', @customerMenuId, 6, 'F', '0', '0', 'system:customer:loginLog', NOW());
```

#### æ–¹å¼äºŒï¼šé€šè¿‡åå°ç®¡ç†ç•Œé¢æ·»åŠ èœå•

1. ç™»å½•åå°ç®¡ç†ç³»ç»Ÿ (http://localhost:80)
2. è¿›å…¥"ç³»ç»Ÿç®¡ç†" -> "èœå•ç®¡ç†"
3. ç‚¹å‡»"æ–°å¢"æŒ‰é’®
4. å¡«å†™èœå•ä¿¡æ¯ï¼š
   - **ä¸Šçº§èœå•**: ç³»ç»Ÿç®¡ç†
   - **èœå•ç±»å‹**: èœå•
   - **èœå•åç§°**: å‰ç«¯ç”¨æˆ·ç®¡ç†
   - **æ˜¾ç¤ºæ’åº**: 2
   - **è·¯ç”±åœ°å€**: customer
   - **ç»„ä»¶è·¯å¾„**: system/customer/index
   - **æƒé™æ ‡è¯†**: system:customer:list
   - **èœå•å›¾æ ‡**: peoples
   - **èœå•çŠ¶æ€**: æ­£å¸¸
5. ä¿å­˜åï¼Œç»§ç»­æ·»åŠ æŒ‰é’®æƒé™ï¼ˆæŸ¥è¯¢ã€æ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤ã€é‡ç½®å¯†ç ã€æŸ¥çœ‹æ—¥å¿—ï¼‰

### å®æ–½æ­¥éª¤

#### æ­¥éª¤1ï¼šåç«¯å¼€å‘ï¼ˆåˆ›å»ºcustomer-adminæ¨¡å—ï¼‰

1. **åˆ›å»ºæ¨¡å—ç›®å½•**
   ```
   backend/meimei-prisma-vue3/meimei-admin/src/modules/customer-admin/
   â”œâ”€â”€ customer-admin.module.ts
   â”œâ”€â”€ customer-admin.controller.ts
   â”œâ”€â”€ customer-admin.service.ts
   â””â”€â”€ dto/
       â”œâ”€â”€ req-customer-admin.dto.ts
       â””â”€â”€ res-customer-admin.dto.ts
   ```

2. **å®ç°7ä¸ªç®¡ç†æ¥å£**
   - åˆ—è¡¨æŸ¥è¯¢ï¼ˆåˆ†é¡µã€æœç´¢ã€ç­›é€‰ï¼‰
   - è¯¦æƒ…æŸ¥è¯¢
   - çŠ¶æ€ä¿®æ”¹
   - å¯†ç é‡ç½®
   - åˆ é™¤ï¼ˆè½¯åˆ é™¤ï¼‰
   - æ‰¹é‡åˆ é™¤
   - ç™»å½•æ—¥å¿—æŸ¥è¯¢

3. **æ·»åŠ æƒé™æ§åˆ¶**
   - ä½¿ç”¨ `@RequiresPermissions()` è£…é¥°å™¨
   - æƒé™æ ‡è¯†ï¼š`system:customer:query`, `system:customer:edit` ç­‰

4. **æ³¨å†Œæ¨¡å—**
   - åœ¨ `app.module.ts` ä¸­å¯¼å…¥ `CustomerAdminModule`

#### æ­¥éª¤2ï¼šå‰ç«¯å¼€å‘ï¼ˆåˆ›å»ºç”¨æˆ·ç®¡ç†é¡µé¢ï¼‰

1. **åˆ›å»ºAPIæ¥å£æ–‡ä»¶**
   - `src/api/system/customer.js`

2. **åˆ›å»ºé¡µé¢ç»„ä»¶**
   - `src/views/system/customer/index.vue`
   - å‚è€ƒ `src/views/system/user/index.vue`
   - ç§»é™¤éƒ¨é—¨ç›¸å…³åŠŸèƒ½
   - è°ƒæ•´å­—æ®µæ˜ å°„

3. **æ·»åŠ è·¯ç”±é…ç½®**ï¼ˆå¯é€‰ï¼Œå¦‚æœä½¿ç”¨é™æ€è·¯ç”±ï¼‰
   - åœ¨ `src/router/index.js` ä¸­æ·»åŠ è·¯ç”±

#### æ­¥éª¤3ï¼šèœå•é…ç½®

1. **æ·»åŠ èœå•æ•°æ®**
   - é€šè¿‡SQLæ’å…¥æˆ–åå°ç•Œé¢æ·»åŠ 

2. **é…ç½®æƒé™**
   - ä¸ºç®¡ç†å‘˜è§’è‰²åˆ†é…"å‰ç«¯ç”¨æˆ·ç®¡ç†"æƒé™

#### æ­¥éª¤4ï¼šæµ‹è¯•

1. **åŠŸèƒ½æµ‹è¯•**
   - åˆ—è¡¨å±•ç¤º
   - æœç´¢ç­›é€‰
   - çŠ¶æ€åˆ‡æ¢
   - å¯†ç é‡ç½®
   - åˆ é™¤æ“ä½œ
   - ç™»å½•æ—¥å¿—æŸ¥çœ‹

2. **æƒé™æµ‹è¯•**
   - éªŒè¯æƒé™æ§åˆ¶æ˜¯å¦ç”Ÿæ•ˆ

### æƒé™æ ‡è¯†åˆ—è¡¨

| æƒé™åç§° | æƒé™æ ‡è¯† | è¯´æ˜ |
|---------|---------|------|
| å‰ç«¯ç”¨æˆ·æŸ¥è¯¢ | system:customer:query | æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨ |
| å‰ç«¯ç”¨æˆ·æ–°å¢ | system:customer:add | æ–°å¢ç”¨æˆ·ï¼ˆå¯é€‰ï¼‰ |
| å‰ç«¯ç”¨æˆ·ä¿®æ”¹ | system:customer:edit | ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ |
| å‰ç«¯ç”¨æˆ·åˆ é™¤ | system:customer:remove | åˆ é™¤ç”¨æˆ· |
| é‡ç½®å¯†ç  | system:customer:resetPwd | é‡ç½®ç”¨æˆ·å¯†ç  |
| æŸ¥çœ‹ç™»å½•æ—¥å¿— | system:customer:loginLog | æŸ¥çœ‹ç”¨æˆ·ç™»å½•æ—¥å¿— |

---

## ğŸ“ é™„å½•ï¼šå®Œæ•´ä»£ç ç¤ºä¾‹

ç”±äºå®Œæ•´ä»£ç è¾ƒé•¿ï¼Œå»ºè®®æŒ‰ç…§ä»¥ä¸‹é¡ºåºé€æ­¥å®æ–½ï¼š

1. **å…ˆå®Œæˆé˜¶æ®µä¸€**ï¼ˆæ•°æ®åº“å‡†å¤‡ï¼‰
2. **å†å®Œæˆé˜¶æ®µäºŒ**ï¼ˆåç«¯APIå¼€å‘ï¼‰
3. **ç„¶åå®Œæˆé˜¶æ®µä¸‰**ï¼ˆå‰ç«¯é¡µé¢æ”¹é€ ï¼‰
4. **æœ€åå®Œæˆé˜¶æ®µå››**ï¼ˆæµ‹è¯•ä¸ä¼˜åŒ–ï¼‰
5. **å¯é€‰é˜¶æ®µäº”**ï¼ˆåå°ç®¡ç†é¡µé¢ - å‰ç«¯ç”¨æˆ·ç®¡ç†ï¼‰

æ¯ä¸ªé˜¶æ®µå®Œæˆåè¿›è¡Œæµ‹è¯•ï¼Œç¡®ä¿åŠŸèƒ½æ­£å¸¸å†è¿›è¡Œä¸‹ä¸€é˜¶æ®µã€‚

---

## ğŸ“Š å®æ–½ä¼˜å…ˆçº§å»ºè®®

### æ ¸å¿ƒåŠŸèƒ½ï¼ˆå¿…é¡»å®æ–½ï¼‰
1. âœ… **é˜¶æ®µä¸€**ï¼šæ•°æ®åº“å‡†å¤‡ï¼ˆåˆ›å»ºcustomerè¡¨ï¼‰
2. âœ… **é˜¶æ®µäºŒ**ï¼šå‰ç«¯ç”¨æˆ·APIå¼€å‘ï¼ˆæ³¨å†Œã€ç™»å½•ã€ä¸ªäººä¿¡æ¯ç®¡ç†ï¼‰
3. âœ… **é˜¶æ®µä¸‰**ï¼šå‰ç«¯é¡µé¢æ”¹é€ ï¼ˆç™»å½•ã€æ³¨å†Œã€ä¸ªäººä¸­å¿ƒï¼‰

### æ‰©å±•åŠŸèƒ½ï¼ˆå¯é€‰å®æ–½ï¼‰
4. â­ **é˜¶æ®µå››**ï¼šåå°ç®¡ç† - å‰ç«¯ç”¨æˆ·ç®¡ç†æ¨¡å—
5. â­ **é˜¶æ®µäº”**ï¼šæ‰¾å›å¯†ç åŠŸèƒ½ï¼ˆéœ€é…ç½®é‚®ä»¶æœåŠ¡ï¼‰
6. â­ **é˜¶æ®µå…­**ï¼šç™»å½•å¤±è´¥æ¬¡æ•°é™åˆ¶ï¼ˆéœ€é…ç½®Redisï¼‰

---

**æ–‡æ¡£ç‰ˆæœ¬**: v2.2ï¼ˆå®Œå–„åå°ç”¨æˆ·ç®¡ç†æ¨¡å—è¯¦ç»†è®¾è®¡ï¼‰
**åˆ›å»ºæ—¥æœŸ**: 2025-11-04
**æœ€åæ›´æ–°**: 2025-11-04
**çŠ¶æ€**: âœ… å¾…å®æ–½
**é¢„è®¡å·¥æœŸ**:
- æ ¸å¿ƒåŠŸèƒ½ï¼š3-4ä¸ªå·¥ä½œæ—¥
- å«åå°ç®¡ç†ï¼š5-7ä¸ªå·¥ä½œæ—¥
- å…¨éƒ¨åŠŸèƒ½ï¼š7-10ä¸ªå·¥ä½œæ—¥

**è”ç³»æ–¹å¼**: å¦‚æœ‰ç–‘é—®ï¼Œè¯·éšæ—¶è¯¢é—®ï¼

