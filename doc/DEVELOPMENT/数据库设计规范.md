# 数据库设计规范文档

## 1. 数据库命名规范

### 1.1 数据库命名
- 数据库名使用小写字母和下划线
- 体现业务含义，避免使用缩写
  ```sql
  -- 推荐
  pet_management_system
  user_center_db
  
  -- 不推荐
  pms
  ucdb
  ```

### 1.2 表命名规范
- 表名使用统一前缀 + 业务含义
- 使用小写字母和下划线分隔
- 表名应为复数形式

**系统表前缀规范:**
- `sys_` : 系统管理相关表
- `user_` : 用户相关表
- `pet_` : 宠物相关表
- `order_` : 订单相关表
- `product_` : 商品相关表
- `log_` : 日志相关表

**示例:**
```sql
sys_users          -- 系统用户表
sys_roles          -- 系统角色表
user_profiles      -- 用户资料表
pet_categories     -- 宠物分类表
pet_breeds         -- 宠物品种表
order_items        -- 订单明细表
product_reviews    -- 商品评价表
log_operations     -- 操作日志表
```

### 1.3 字段命名规范
- 字段名使用小写字母和下划线
- 字段名要体现具体含义
- 布尔类型字段使用 `is_` 或 `has_` 前缀

**常用字段命名:**
```sql
id              -- 主键ID
user_id         -- 用户ID
user_name       -- 用户名
email_address   -- 邮箱地址
phone_number    -- 手机号码
created_at      -- 创建时间
updated_at      -- 更新时间
deleted_at      -- 删除时间
is_active       -- 是否激活
is_deleted      -- 是否删除
has_permission  -- 是否有权限
status          -- 状态
sort_order      -- 排序
```

## 2. 数据类型规范

### 2.1 主键设计
- 每张表必须设置主键
- 建议使用自增ID作为主键
- 主键字段统一命名为 `id`

```sql
CREATE TABLE sys_users (
    id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '用户ID',
    -- 其他字段
);
```

### 2.2 字段类型选择

**字符串类型:**
- `VARCHAR(50)` : 短文本（用户名、姓名等）
- `VARCHAR(255)` : 中等文本（邮箱、地址等）
- `TEXT` : 长文本（描述、内容等）
- `CHAR(32)` : 固定长度（MD5、UUID等）

**数值类型:**
- `TINYINT` : 状态值、布尔值 (0-255)
- `INT` : 普通整数
- `BIGINT` : 大整数（ID、时间戳等）
- `DECIMAL(10,2)` : 金额、价格

**时间类型:**
- `DATETIME` : 日期时间（推荐）
- `TIMESTAMP` : 时间戳
- `DATE` : 仅日期
- `TIME` : 仅时间

**示例表结构:**
```sql
CREATE TABLE sys_users (
    id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '用户ID',
    user_name VARCHAR(50) NOT NULL COMMENT '用户名',
    email_address VARCHAR(255) NOT NULL COMMENT '邮箱地址',
    phone_number VARCHAR(20) DEFAULT NULL COMMENT '手机号码',
    password_hash CHAR(64) NOT NULL COMMENT '密码哈希',
    user_status TINYINT DEFAULT 1 COMMENT '用户状态：1-正常，2-禁用，3-删除',
    is_active TINYINT DEFAULT 1 COMMENT '是否激活：1-是，0-否',
    last_login_at DATETIME DEFAULT NULL COMMENT '最后登录时间',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='系统用户表';
```

## 3. 索引设计规范

### 3.1 主键索引
- 每张表必须有主键索引
- 主键建议使用自增ID

### 3.2 唯一索引
- 业务唯一字段必须添加唯一索引
```sql
-- 用户名唯一索引
ALTER TABLE sys_users ADD UNIQUE INDEX uk_user_name (user_name);
-- 邮箱唯一索引
ALTER TABLE sys_users ADD UNIQUE INDEX uk_email (email_address);
```

### 3.3 普通索引
- 频繁查询的字段添加索引
- 外键字段必须添加索引
```sql
-- 状态索引
ALTER TABLE sys_users ADD INDEX idx_status (user_status);
-- 创建时间索引
ALTER TABLE sys_users ADD INDEX idx_created_at (created_at);
-- 组合索引
ALTER TABLE order_items ADD INDEX idx_order_product (order_id, product_id);
```

### 3.4 索引命名规范
- 主键索引: `PRIMARY`
- 唯一索引: `uk_字段名`
- 普通索引: `idx_字段名`
- 组合索引: `idx_字段1_字段2`

## 4. 外键关系设计

### 4.1 外键约束
- 表与表之间的关联通过外键明确
- 外键必须关联对应表的主键
- 外键字段命名: `关联表名_id`

```sql
CREATE TABLE user_profiles (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL COMMENT '用户ID',
    real_name VARCHAR(50) DEFAULT NULL COMMENT '真实姓名',
    avatar_url VARCHAR(255) DEFAULT NULL COMMENT '头像地址',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    -- 外键约束
    FOREIGN KEY (user_id) REFERENCES sys_users(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户资料表';
```

### 4.2 关联关系类型
- **一对一**: 用户表 ↔ 用户资料表
- **一对多**: 用户表 → 订单表
- **多对多**: 用户表 ↔ 角色表（通过中间表）

**多对多关系示例:**
```sql
-- 用户角色关联表
CREATE TABLE user_role_relations (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL COMMENT '用户ID',
    role_id BIGINT NOT NULL COMMENT '角色ID',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (user_id) REFERENCES sys_users(id) ON DELETE CASCADE,
    FOREIGN KEY (role_id) REFERENCES sys_roles(id) ON DELETE CASCADE,
    UNIQUE KEY uk_user_role (user_id, role_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户角色关联表';
```

## 5. 数据完整性规范

### 5.1 NOT NULL约束
- 重要字段设置NOT NULL约束
- 可选字段允许NULL值

### 5.2 DEFAULT值设置
- 为字段设置合理的默认值
- 时间字段使用CURRENT_TIMESTAMP

### 5.3 CHECK约束
- 对数据范围进行约束
```sql
ALTER TABLE sys_users ADD CONSTRAINT chk_status 
CHECK (user_status IN (1, 2, 3));
```

## 6. 表设计最佳实践

### 6.1 通用字段
每张业务表建议包含以下通用字段:
```sql
created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
created_by BIGINT DEFAULT NULL COMMENT '创建人ID',
updated_by BIGINT DEFAULT NULL COMMENT '更新人ID'
```

### 6.2 软删除设计
重要数据采用软删除方式:
```sql
is_deleted TINYINT DEFAULT 0 COMMENT '是否删除：1-是，0-否',
deleted_at DATETIME DEFAULT NULL COMMENT '删除时间',
deleted_by BIGINT DEFAULT NULL COMMENT '删除人ID'
```

### 6.3 状态字段设计
使用数字表示状态，并添加详细注释:
```sql
order_status TINYINT DEFAULT 1 COMMENT '订单状态：1-待支付，2-已支付，3-已发货，4-已完成，5-已取消'
```

## 7. 性能优化建议

### 7.1 分表策略
- 单表数据量超过500万考虑分表
- 按时间、地区或业务维度分表

### 7.2 读写分离
- 主库负责写操作
- 从库负责读操作

### 7.3 缓存策略
- 热点数据使用Redis缓存
- 查询结果缓存减少数据库压力

## 8. 数据库文档维护

### 8.1 表结构文档
- 每张表必须有详细的字段说明
- 定期更新数据库设计文档

### 8.2 变更记录
- 记录每次表结构变更
- 保留变更SQL脚本

---

**文档版本**: v1.0  
**最后更新**: 2024年12月  
**维护人员**: 数据库团队